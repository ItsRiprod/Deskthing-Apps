<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Media Player - DeskThing Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .player {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        .artwork {
            width: 100%;
            height: 300px;
            border-radius: 15px;
            object-fit: cover;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .track-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .track-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0 0 8px 0;
        }

        .track-artist {
            font-size: 18px;
            color: #666;
            margin: 0 0 4px 0;
        }

        .track-album {
            font-size: 16px;
            color: #999;
            margin: 0;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.1s ease;
            width: 0%;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 24px;
        }

        .control-btn.play-pause {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 80px;
            height: 80px;
            font-size: 32px;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .control-btn.play-pause:hover {
            box-shadow: 0 12px 24px rgba(102, 126, 234, 0.4);
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            font-size: 14px;
            color: #666;
        }

        .status.playing {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Hidden audio element for Media Session API -->
    <audio id="hiddenAudio" loop preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvGEeAynA5/qhZhwPZLPr3YhODwlFpOHyvGUcCjiS2O/MeSwGJjvN8N6PQgkTW7Tr66hV" type="audio/wav">
    </audio>
    
    <div class="player">
        <img id="artwork" class="artwork" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Crect fill='%23667eea' width='300' height='300'/%3E%3Ctext fill='white' font-size='24' x='150' y='160' text-anchor='middle'%3ETest Track%3C/text%3E%3C/svg%3E" alt="Album Artwork">
        
        <div class="track-info">
            <h2 id="title" class="track-title">Test Track</h2>
            <p id="artist" class="track-artist">Test Artist</p>
            <p id="album" class="track-album">Test Album</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div id="progress" class="progress-fill"></div>
            </div>
            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">3:45</span>
            </div>
        </div>

        <div class="controls">
            <button id="prevBtn" class="control-btn">⏮</button>
            <button id="playPauseBtn" class="control-btn play-pause">▶️</button>
            <button id="nextBtn" class="control-btn">⏭</button>
        </div>

        <div id="status" class="status">Ready to play</div>
    </div>

    <script>
        class TestMediaPlayer {
            constructor() {
                this.isPlaying = false;
                this.currentTrackIndex = 0;
                this.currentTime = 0;
                this.duration = 225; // 3:45 in seconds
                this.progressInterval = null;

                this.tracks = [
                    {
                        title: "Rinzen - Live from Silo Brooklyn (2025)",
                        artist: "Rinzen",
                        album: "Live Sets",
                        artwork: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Crect fill='%23ff6b6b' width='300' height='300'/%3E%3Ctext fill='white' font-size='18' x='150' y='150' text-anchor='middle'%3ERinzen Live%3C/text%3E%3C/svg%3E",
                        duration: 225
                    },
                    {
                        title: "Test Song 2",
                        artist: "Another Artist",
                        album: "Test Album 2",
                        artwork: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Crect fill='%2351cf66' width='300' height='300'/%3E%3Ctext fill='white' font-size='18' x='150' y='150' text-anchor='middle'%3ETest Song 2%3C/text%3E%3C/svg%3E",
                        duration: 180
                    },
                    {
                        title: "Another Track",
                        artist: "Different Artist",
                        album: "Cool Album",
                        artwork: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' viewBox='0 0 300 300'%3E%3Crect fill='%23ffd43b' width='300' height='300'/%3E%3Ctext fill='white' font-size='18' x='150' y='150' text-anchor='middle'%3EAnother Track%3C/text%3E%3C/svg%3E",
                        duration: 210
                    }
                ];

                this.initializeElements();
                this.setupEventListeners();
                this.setupMediaSession();
                this.updateTrackDisplay();
            }

            initializeElements() {
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.titleEl = document.getElementById('title');
                this.artistEl = document.getElementById('artist');
                this.albumEl = document.getElementById('album');
                this.artworkEl = document.getElementById('artwork');
                this.progressEl = document.getElementById('progress');
                this.currentTimeEl = document.getElementById('currentTime');
                this.durationEl = document.getElementById('duration');
                this.statusEl = document.getElementById('status');
                this.hiddenAudio = document.getElementById('hiddenAudio');
                
                // Set audio volume to very low but not muted
                this.hiddenAudio.volume = 0.01;
            }

            setupEventListeners() {
                this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
                this.prevBtn.addEventListener('click', () => this.previousTrack());
                this.nextBtn.addEventListener('click', () => this.nextTrack());
            }

            setupMediaSession() {
                if ('mediaSession' in navigator) {
                    console.log('Setting up Media Session API');
                    
                    // Force playback state to claim media session
                    navigator.mediaSession.playbackState = 'paused';
                    
                    navigator.mediaSession.setActionHandler('play', () => {
                        console.log('Media Session: play action');
                        this.play();
                    });
                    
                    navigator.mediaSession.setActionHandler('pause', () => {
                        console.log('Media Session: pause action');
                        this.pause();
                    });
                    
                    navigator.mediaSession.setActionHandler('previoustrack', () => {
                        console.log('Media Session: previoustrack action');
                        this.previousTrack();
                    });
                    
                    navigator.mediaSession.setActionHandler('nexttrack', () => {
                        console.log('Media Session: nexttrack action');
                        this.nextTrack();
                    });

                    // Add seek handlers
                    navigator.mediaSession.setActionHandler('seekto', (details) => {
                        console.log('Media Session: seekto action', details);
                        if (details.seekTime) {
                            this.currentTime = Math.min(details.seekTime, this.duration);
                            this.updateTimeDisplay();
                            this.updateMediaSessionMetadata();
                        }
                    });

                    // Update metadata immediately
                    this.updateMediaSessionMetadata();
                    
                    console.log('Media Session handlers registered successfully');
                    this.statusEl.textContent = 'Media Session API ready - try your media keys!';
                } else {
                    console.warn('Media Session API not supported');
                    this.statusEl.textContent = 'Media Session API not supported in this browser';
                }
            }

            updateMediaSessionMetadata() {
                if ('mediaSession' in navigator) {
                    const track = this.tracks[this.currentTrackIndex];
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: track.title,
                        artist: track.artist,
                        album: track.album,
                        artwork: [
                            { src: track.artwork, sizes: '300x300', type: 'image/svg+xml' }
                        ]
                    });

                    // Update position state
                    navigator.mediaSession.setPositionState({
                        duration: this.duration,
                        playbackRate: 1.0,
                        position: this.currentTime
                    });
                }
            }

            updateTrackDisplay() {
                const track = this.tracks[this.currentTrackIndex];
                this.titleEl.textContent = track.title;
                this.artistEl.textContent = track.artist;
                this.albumEl.textContent = track.album;
                this.artworkEl.src = track.artwork;
                this.duration = track.duration;
                this.currentTime = 0;
                this.updateTimeDisplay();
                this.updateMediaSessionMetadata();
            }

            togglePlayPause() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }

            play() {
                this.isPlaying = true;
                this.playPauseBtn.textContent = '⏸️';
                this.statusEl.textContent = 'Playing';
                this.statusEl.className = 'status playing';
                this.startProgressUpdate();
                
                // Play the hidden audio to activate Media Session
                this.hiddenAudio.play().catch(e => {
                    console.log('Audio play failed (this is normal on first load):', e.message);
                });
                
                // Update Media Session playback state
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'playing';
                }
                
                console.log('Playing:', this.tracks[this.currentTrackIndex].title);
            }

            pause() {
                this.isPlaying = false;
                this.playPauseBtn.textContent = '▶️';
                this.statusEl.textContent = 'Paused';
                this.statusEl.className = 'status';
                this.stopProgressUpdate();
                
                // Pause the hidden audio
                this.hiddenAudio.pause();
                
                // Update Media Session playback state
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'paused';
                }
                
                console.log('Paused');
            }

            previousTrack() {
                this.currentTrackIndex = (this.currentTrackIndex - 1 + this.tracks.length) % this.tracks.length;
                this.updateTrackDisplay();
                console.log('Previous track:', this.tracks[this.currentTrackIndex].title);
                
                if (this.isPlaying) {
                    // Keep playing
                    this.startProgressUpdate();
                }
            }

            nextTrack() {
                this.currentTrackIndex = (this.currentTrackIndex + 1) % this.tracks.length;
                this.updateTrackDisplay();
                console.log('Next track:', this.tracks[this.currentTrackIndex].title);
                
                if (this.isPlaying) {
                    // Keep playing
                    this.startProgressUpdate();
                }
            }

            startProgressUpdate() {
                this.stopProgressUpdate();
                this.progressInterval = setInterval(() => {
                    if (this.currentTime < this.duration) {
                        this.currentTime += 1;
                        this.updateTimeDisplay();
                        this.updateMediaSessionMetadata();
                    } else {
                        // Track ended, go to next
                        this.nextTrack();
                    }
                }, 1000);
            }

            stopProgressUpdate() {
                if (this.progressInterval) {
                    clearInterval(this.progressInterval);
                    this.progressInterval = null;
                }
            }

            updateTimeDisplay() {
                const progress = (this.currentTime / this.duration) * 100;
                this.progressEl.style.width = `${progress}%`;
                this.currentTimeEl.textContent = this.formatTime(this.currentTime);
                this.durationEl.textContent = this.formatTime(this.duration);
            }

            formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
        }

        // Initialize the player when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.player = new TestMediaPlayer();
            console.log('Test Media Player initialized');
            console.log('Try using your system media keys or DeskThing to control this player!');
        });
    </script>
</body>
</html> 